{% extends "base.html" %}

<!-- Example row of columns -->
{% block stuff %}

<div class="fluid-row">
  <h2>Historical storage quota used on UPPMAX projects</h2>
</div>
<div class="row">

  <!-- <div class="span4"> -->
    <!-- <h2><a href="/quotas/{ project }}">{ project }}</a></h2> -->
    <!-- <div class="chart_container" id="chart_container"> -->
      <!-- <div class="y_axis" id="y_axis_{ project }}"></div> -->
      <!-- <div class="chart" id="chart_{ project }}"></div> -->
    <!-- </div> -->
  <!-- </div> -->

</div>

<script>

var time = new Rickshaw.Fixtures.Time();
var time_unit = time.unit('month');
var ups

$.getJSON("/api/v1/uppmax_projects", function(uppmax_projects) {

  ups = uppmax_projects

  $.each(ups, function(i, up) {
    $(".row").append('<div class="span4" id="container_' + up + '"></div>')

    var chart = '<div class="chart_container">' + 
    '<div class="y_axis" id="y_axis_' + up + '"></div>' +
    '<div class="chart" id="chart_' + up + '"></div>' +
    '</div>'

    $("#container_" + up)
          .append('<h2><a href="/quotas/' + up + '">' + up + '</h2></a>')
          .append(chart)
  });

}).then(function() {

  $.each(ups, function(j, up) {
    $.getJSON("/api/v1/quotas/" + up, function(data) {

      var my_data = data[0]

      var graph = new Rickshaw.Graph( {

        element: $("#chart_" + up).get(0),
        renderer: "bar",
        series: [
          {
            data: my_data["data"],
            name: "my_data",
            color: "#0093b9"
          }
        ]

      });

      graph.render();

    var hoverDetail = new Rickshaw.Graph.HoverDetail( {
      graph: graph
    } );

    var x_axes = new Rickshaw.Graph.Axis.Time( {
      graph: graph,
      timeUnit: time_unit
    } );

    x_axes.render();

      var y_axis = new Rickshaw.Graph.Axis.Y({

      graph: graph,
      orientation: 'left',
      element: $("#y_axis_" + up).get(0),
      tickFormat: Rickshaw.Fixtures.Number.formatBase1024KMGTP

      });

      y_axis.render();

    });
  });
});

</script>

{% end %}
