{% extends "base.html" %}

<!-- Example row of columns -->
{% block stuff %}

<div class="fluid-row">
  <h2>Historical storage quota used on UPPMAX projects</h2>
</div>
<div class="row"></div>

<script>

var time = new Rickshaw.Fixtures.Time();
var time_unit = time.unit('month');
var ups

$.getJSON("/api/v1/uppmax_projects", function(uppmax_projects) {

  ups = uppmax_projects

  $.each(ups, function(i, up) {
    $(".row").append('<div class="span4" id="container_' + up + '"></div>')

    var chart = '<div class="chart_container">' + 
    '<div class="y_axis" id="y_axis_' + up + '"></div>' +
    '<svg id="chart_' + up + '"></svg>' +
    '</div>'

    $("#container_" + up)
          .append('<h2><a href="/quotas/' + up + '">' + up + '</h2></a>')
          .append(chart)
  });

}).then(function() {
  $.each(ups, function(j, up) {
    $.getJSON("/api/v1/quotas/" + up, function(data) {

      var my_data = data[0]["data"]

      var chart = nv.models.linePlusBarChart()
              .x(function(d) { return d["x"] * 1000 })
              .y(function(d) { return d["y"] });

      chart.xAxis
        .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

      chart.yAxis1
          .tickFormat(d3.format("2.2s"))

      d3.select("#chart_" + up)
          .datum([{values: my_data, key: "banana", bar: true}])
        .call(chart);

      return chart;

    })
  })
});

</script>

{% end %}
