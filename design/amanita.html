{% extends "base.html" %}

<!-- Example row of columns -->
{% block stuff %}
<div class="container-fluid">
  <h2>Amanita</h2>
  <div class="single_chart_container" id="chart_container">
    <svg id="amanita_chart"></svg>
  </div>
</div>

<script>

var users = [""];
var user_data = [];

var chart = nv.models.lineWithFocusChart()
  .x(function(d) { return d["x"] })
  .y(function(d) { return d["y"] });

chart.xAxis
  .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

chart.x2Axis
  .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

chart.yAxis
    .tickFormat(d3.format("2.2s"));

chart.y2Axis
    .tickFormat(d3.format("2.2s"));

nv.utils.windowResize(function() {d3.select('#amanita_chart').call(chart)})

$.getJSON("api/v1/amanita_home/users/", function(users_json) {
  users = users_json;
})
.then(function() {
  $.getJSON("/api/v1/amanita_home", function(total_json) {
    user_data.push({values: total_json, key: "Total"});
  })
  .then(function() {

    $.each(users, function(i, user) {
      $.getJSON("/api/v1/amanita_home/" + user, function(user_json) {
        user_data.push({values: user_json, key: user});
      })
      .then(function() {

        d3.select("#amanita_chart")
          .datum(user_data)
          .call(chart);

      });
    });
  });
});

</script>

{% end %}