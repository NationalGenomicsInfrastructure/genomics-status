{% extends "base.html" %}

<!-- Example row of columns -->
{% block stuff %}

<div class="container-fluid" id="sample_list">

  <h2>{{ flowcell }}</h2>
  <table class="table table-bordered" id="fc_info">
    <tbody></tbody>
  </table>

  <h3>Lane QC</h3>
  <div id="lanes">
  </div>
  
  <table class="table table-bordered" id="fc_qc">
    <tbody></tbody>
  </table>

  <h3>Sample Runs</h3>
  <br>
</div>

<script>

$.getJSON("/api/v1/flowcell_info/{{ flowcell }}", function(data) {

  tbody = "<tr><th>Start date</th><td>" + data["startdate"];
  tbody += "<th>Instrument id</th><td>" + data["instrument"];
  tbody += "<th>Flowcell</th><td>" + data["flowcell"];
  tbody += "</td></tr>";

  $("#fc_info tbody").html(tbody);

});

$.getJSON("/api/v1/flowcell_qc/{{ flowcell }}", function(data) {
  $.each(data, function(lane, qc) {

    var qc_table = '<table class="table table-bordered"><tbody>';

    row_pair = function(key) {
      var row = "<td>" + qc["read1"][key] + " ± ";
      row += qc["read1"][key + "SD"] + "</td>";
      row += "<td>" + qc["read3"][key] + " ± ";
      row += qc["read3"][key + "SD"] + "</td>";

      return row
    }

    qc_table += "<tr><th><h4>Lane " + lane + "</h4></th><th>Read 1</th><th>Read 3</th></tr>";
    qc_table += "<tr><th>Clusters raw</th>";
    qc_table += row_pair("ClustersRaw")
    qc_table += "<tr><th>Clusters PF</th>";
    qc_table += row_pair("ClustersPF")
    qc_table += "<tr><th>Error rate PhiX</th>";
    qc_table += row_pair("ErrRatePhiX")

    qc_table += "<tr><th>Phasing</th>";
    qc_table += "<td>" + qc["read1"]["Phasing"] + "</td>";
    qc_table += "<td>" + qc["read3"]["Phasing"] + "</td></tr>";
    qc_table += "<tr><th>Prephasing</th>";
    qc_table += "<td>" + qc["read1"]["Prephasing"] + "</td>";
    qc_table += "<td>" + qc["read3"]["Prephasing"] + "</td></tr>";

    qc_table += "<tr><th>% aligned</th>";
    qc_table += row_pair("PrcAlign")
    qc_table += "</tbody></table>";

    $("#lanes").append(qc_table);
  })

});


$.getJSON("/api/v1/flowcells/{{ flowcell }}", function(data) {
  $.each(data, function (index, sample_run) {
    $("#sample_list").append('<div class="span3"><p><a href="/qc/' + 
      sample_run + '">' + sample_run + '</p></div>')
  });
});

</script>

{% end %}
