{% extends "base.html" %}

<!-- Example row of columns -->
{% block stuff %}

<div class="container-fluid">
  <h2>Project Applications</h2>
  <div id="slider"></div>
  <h2 id="dates"></h2>
  <p>
    Counts of the different sequencing applications that have been run.
  </p>

  <div class="single_chart_container" id="main_chart">
  </div>

  <table class="table table-bordered" id="application_table">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h2>Samples applications</h2>
  <div class="single_chart_container" id="per_sample_chart">
  </div>

</div>

<script type="text/javascript">
var start = new Date(2012,0,1);
var stop = new Date();

$("#slider").dateRangeSlider({
  bounds:
  {
    min: start,
    max: stop
  },
  defaultValues:
  {
    min: start,
    max: stop
  },
  min: 1,
  max: 12,
  values: [2, 12],
  step:
  {
    days: 1
  },
});

function load_plot(start, stop){
  start_string = $.datepicker.formatDate('yy-mm-dd',start);
  stop_string = $.datepicker.formatDate('yy-mm-dd',stop);
  $("#dates").text("Date range: " + start_string + " - " + stop_string)
  $("#main_chart").html('<img src="/api/v1/applications.png?start=' + start + '&end=' + stop + '"/>')
  $("#per_sample_chart").html('<img src="/api/v1/samples_application.png?start=' + start + '&end=' + stop + '"/>')
}

$("#slider").bind("valuesChanged", function(e, data){
    load_plot(data.values.min,data.values.max)
});

$.getJSON("/api/v1/applications", function(data) {
  for (d in data) {
    var trow = '<tr class="a" onclick="document.location = '
    trow += "'/application/" + d + "'"
    trow += '" onmouseover="this.style.cursor='
    trow += "'pointer'"
    trow += '">'
    trow += '<td>' + d + '</td><td>' + data[d]+ '</td></tr>'
    $("#application_table tbody").append(trow)
  };
})

</script>

{% end %}
