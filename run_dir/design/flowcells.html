{% extends "base.html" %}

<!-- 
Template file: flowcells.html
URL: /flowcells
Title: Summary of all Flowcells 
Description: Shows a table with all flow cells.
-->

{% block stuff %}

<div class="container-fluid" id="flowcell_list">
  <div id="fc_table_div">
      <h1><span id="page_title">Flowcells</span> </h1>
      <table class="table table-striped table-bordered sortable" id="fc_table">
        <thead>
          <tr>
            <th class="sort" data-sort="run_id">Run id</th>
            <th class="sort" data-sort="start_date">Start date</th>
            <th class="sort" data-sort="system">System</th>
            <th class="sort" data-sort="mode">Mode</th>
            <th class="sort" data-sort="chemistry">Chemistry</th>
            <th class="sort" data-sort="recipe">Recipe</th>
            <th class="sort" data-sort="software_version">Software Version</th>
            <th class="sort" data-sort="yield">Yield (<abbr title="Giga bases">Gb</abbr>)</th>
            <th class="sort" data-sort="flowcell">Flowcell</th>
            <th class="sort" data-sort="pos">Pos</th>
            <th class="sort" data-sort="instrument">Instrument</th>
            <th class="sort" data-sort="demultiplexing">Demultiplexing</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <th class="sort" data-sort="run_id">Run id</th>
            <th class="sort" data-sort="start_date">Start date</th>
            <th class="sort" data-sort="system">System</th>
            <th class="sort" data-sort="mode">Mode</th>
            <th class="sort" data-sort="chemistry">Chemistry</th>
            <th class="sort" data-sort="recipe">Recipe</th>
            <th class="sort" data-sort="software_version">Software Version</th>
            <th class="sort" data-sort="yield">Yield (<abbr title="Giga bases">Gb</abbr>)</th>
            <th class="sort" data-sort="flowcell">Flowcell</th>
            <th class="sort" data-sort="pos">Pos</th>
            <th class="sort" data-sort="instrument">Instrument</th>
            <th class="sort" data-sort="demultiplexing">Demultiplexing</th>
          </tr>
        </tfoot>
        <tbody class="list">

         {% for onefc in flowcells %}
            <tr>
                <td class="run_id"><a href="/flowcells/{{ onefc }}">{{ flowcells[onefc]["run id"] }}</a></td>
                <td class="start_date">20{{ flowcells[onefc]["startdate"][0:2] }}{{ flowcells[onefc]["startdate"][2:4] }}{{ flowcells[onefc]["startdate"][4:] }}</td>
                <td class="system">
                {% if 'type' in flowcells[onefc]%}
                    {{ flowcells[onefc]['type'].split(" ")[0] }}
                {% else%}
                    -
                {% end %}
                </td>
                <td class="mode">{{ flowcells[onefc].get('mode', '-') }}</td>
                <td class="chemistry" class="text-center">
                {% if 'fctype' in flowcells[onefc] %}
                    {{ flowcells[onefc]['fctype'].split(" ")[-1] }}
                {% elif 'kitver' in flowcells[onefc] %}
                    {{ flowcells[onefc]['kitver'][-2:] }}
                {% else %}
                -
                {% end %}
                </td>
                <td class="recipe">{{ flowcells[onefc].get('recipe', '-') }}</td>
                <td class="software_version">{{ flowcells[onefc].get('appver', '-') }}</td>
                <td class="yield" class="text-right">{{ flowcells[onefc].get('yield', '-') }}</td>
                <td class="flowcell">{{ flowcells[onefc]['flowcell'] }}</td>
                <td class="pos" class="text-center">{{ flowcells[onefc]['pos'] }}</td>
                <td class="instrument">{{ flowcells[onefc]['instrument'] }}</td>
                <td class="demultiplexing">{{ flowcells[onefc]['demultiplexing'] }}</td>
            </tr>
         {% end %}
        </tbody>
      </table>
    </div>
</div>

<script src="/static/js/jquery.dataTables.min.js"></script>
<!-- Table Sorting -->
<script type="text/javascript">
$( document ).ready(function() {
init_listjs();
});
    // Populate the page
    /*$.getJSON("/api/v1/flowcells", function(data) {
        var tbl_bdy = "";
        var num_rows = 0;
        $.each(data, function(flowcell, info) {
            num_rows++;
            var system="-";
            if (info['type']){
                system=info['type'].split(" ")[0];
            }
    
            var chem="-";
            if (info['fctype']){
                var ar=info['fctype'].split(" ");
                chem=ar[ar.length-1];
            } else if (info['kitver']){
                chem=info['kitver'].substr(info['kitver'].length-2);
            }

            tbl_bdy += ['<tr>',
                '<td class="run_id"><a href="/flowcells/' + flowcell + '">' + info["run id"] + '</a></td>',
                '<td class="start_date">20' + info['startdate'].substr(0,2) + '-' + info['startdate'].substr(2,2) + '-' + info['startdate'].substr(4) + '</td>',
                '<td class="system">' + system+ '</td>',
                '<td class="mode">' + (info['mode'] ? info['mode'] : '-') + '</td>',
                '<td class="chemistry" class="text-center">' + chem + '</td>',
                '<td class="recipe">' + (info['recipe'] ? info['recipe'] : '-') + '</td>',
                '<td class="software_version">' + (info['appver'] ? info['appver'] : '-') + '</td>',
                '<td class="yield" class="text-right">' + (info['yield'] ? info['yield'] : '-') + '</td>',
                '<td class="flowcell">' + info['flowcell'] + '</td>',
                '<td class="pos" class="text-center">' + info['pos'] + '</td>',
                '<td class="instrument">' + info['instrument'] + '</td>',
                '<td class="demultiplexing">' + info['demultiplexing'] + '</td>',
            '</tr>'].join('\n');
        })

        $("#fc_table tbody").html(tbl_bdy);
        
        init_listjs(num_rows);
    });
});
*/
// Initialize sorting and searching javascript plugin
<<<<<<< HEAD
function init_listjs() {
    // Setup - add a text input to each footer cell
    $('#fc_table tfoot th').each( function () {
      var title = $('#fc_table thead th').eq( $(this).index() ).text();
      $(this).html( '<input size=10 type="text" placeholder="Search '+title+'" />' );
    } );
                             
    var table = $('#fc_table').DataTable({
      "paging":false,
      "info":false,
      "order": [[ 0, "desc" ]]
    });

    //Add the bootstrap classes to the search thingy
    $('div.dataTables_filter input').addClass('form-control search search-query');
    $('#fc_table_filter').addClass('form-inline pull-right');
    $("#fc_table_filter").appendTo("h1");
    $('#fc_table_filter label input').appendTo($('#fc_table_filter'));
    $('#fc_table_filter label').remove();
    $("#fc_table_filter input").attr("placeholder", "Search..");
    // Apply the search
    table.columns().every( function () {
        var that = this;
        $( 'input', this.footer() ).on( 'keyup change', function () {
            that
            .search( this.value )
            .draw();
        } );
    } );
}
</script>


{% end %}
